poetry run pytest
============================= test session starts ==============================
platform darwin -- Python 3.10.15, pytest-8.3.3, pluggy-1.5.0
rootdir: /Users/oscarbahamonde/Desktop/realitydb
configfile: pyproject.toml
testpaths: tests
plugins: asyncio-0.24.0, cov-4.1.0, anyio-4.6.2.post1
asyncio: mode=strict, default_loop_scope=None
collected 9 items

tests/test_item.py FFFFFFFFF                                             [100%]

=================================== FAILURES ===================================
______________________________ test_create_table _______________________________

client = <async_generator object client at 0x103d835c0>

    @pytest.mark.asyncio
    async def test_create_table(client: RPCClient[TestDocument]):
>       result = await client.create_table(table_name="test_table")
E       AttributeError: 'async_generator' object has no attribute 'create_table'

tests/test_item.py:38: AttributeError
______________________________ test_delete_table _______________________________

client = <async_generator object client at 0x103db8ac0>

    @pytest.mark.asyncio
    async def test_delete_table(client: RPCClient[TestDocument]):
>       result = await client.delete_table(table_name="test_table")
E       AttributeError: 'async_generator' object has no attribute 'delete_table'

tests/test_item.py:43: AttributeError
________________________________ test_get_item _________________________________

client = <async_generator object client at 0x103db8dc0>

    @pytest.mark.asyncio
    async def test_get_item(client: RPCClient[TestDocument]):
>       result = await client.get_item(table_name="test_table", id="1")
E       AttributeError: 'async_generator' object has no attribute 'get_item'

tests/test_item.py:48: AttributeError
___________________________ test_get_item_not_found ____________________________

client = <async_generator object client at 0x103db8fc0>

    @pytest.mark.asyncio
    async def test_get_item_not_found(client: RPCClient[TestDocument]):
        with pytest.raises(RPCError) as error:
>           await client.get_item(table_name="test_table", id="1")
E           AttributeError: 'async_generator' object has no attribute 'get_item'

tests/test_item.py:55: AttributeError
________________________________ test_put_item _________________________________

client = <async_generator object client at 0x103db91c0>

    @pytest.mark.asyncio
    async def test_put_item(client: RPCClient[TestDocument]):
        item = TestDocument(id="1", foreign_key="2")
>       result = await client.put_item(table_name="test_table", item=item)
E       AttributeError: 'async_generator' object has no attribute 'put_item'

tests/test_item.py:62: AttributeError
_______________________________ test_delete_item _______________________________

client = <async_generator object client at 0x103db9440>

    @pytest.mark.asyncio
    async def test_delete_item(client: RPCClient[TestDocument]):
>       result = await client.delete_item(table_name="test_table", id="1")
E       AttributeError: 'async_generator' object has no attribute 'delete_item'

tests/test_item.py:68: AttributeError
__________________________________ test_query __________________________________

client = <async_generator object client at 0x103db9640>

    @pytest.mark.asyncio
    async def test_query(client: RPCClient[TestDocument]):
>       result = await client.query(table_name="test_table", limit=2)
E       AttributeError: 'async_generator' object has no attribute 'query'

tests/test_item.py:73: AttributeError
_______________________________ test_update_item _______________________________

client = <async_generator object client at 0x103db98c0>

    @pytest.mark.asyncio
    async def test_update_item(client: RPCClient[TestDocument]):
>       result = await client.update_item(table_name="test_table", id="1", updates={"foreign_key": "3"})
E       AttributeError: 'async_generator' object has no attribute 'update_item'

tests/test_item.py:80: AttributeError
___________________________ test_connection_handling ___________________________

mock_websocket = <coroutine object mock_websocket at 0x103d97a00>

    @pytest.mark.asyncio
    async def test_connection_handling(mock_websocket):
        async def mock_connect(*args, **kwargs):
            return mock_websocket
    
        with patch('websockets.connect', new=mock_connect):
            async with RPCClient[TestDocument](TestDocument, uri="ws://test") as client:
                assert client.ws is not None
>               result = await client.create_table(table_name="test_table")

tests/test_item.py:92: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
realitydb/rpc_client.py:64: in create_table
    return await self._send_request("CreateTable", {"table_name": table_name})
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <realitydb.rpc_client.RPCClient object at 0x103de7fa0>
method = 'CreateTable', params = {'table_name': 'test_table'}

    async def _send_request(self, method: GlowMethod, params: Dict[str, Any]) -> O:
>       if not self.ws or self.ws.closed:
E       AttributeError: 'coroutine' object has no attribute 'closed'. Did you mean: 'close'?

realitydb/rpc_client.py:46: AttributeError

During handling of the above exception, another exception occurred:

mock_websocket = <coroutine object mock_websocket at 0x103d97a00>

    @pytest.mark.asyncio
    async def test_connection_handling(mock_websocket):
        async def mock_connect(*args, **kwargs):
            return mock_websocket
    
        with patch('websockets.connect', new=mock_connect):
>           async with RPCClient[TestDocument](TestDocument, uri="ws://test") as client:

tests/test_item.py:90: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
realitydb/rpc_client.py:106: in __aexit__
    await self.close()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <realitydb.rpc_client.RPCClient object at 0x103de7fa0>

    async def close(self):
>       if self.ws and not self.ws.closed:
E       AttributeError: 'coroutine' object has no attribute 'closed'. Did you mean: 'close'?

realitydb/rpc_client.py:41: AttributeError
=============================== warnings summary ===============================
../../Library/Caches/pypoetry/virtualenvs/realitydb-3Co-d7Gu-py3.10/lib/python3.10/site-packages/pydantic/_internal/_generate_schema.py:312
../../Library/Caches/pypoetry/virtualenvs/realitydb-3Co-d7Gu-py3.10/lib/python3.10/site-packages/pydantic/_internal/_generate_schema.py:312
../../Library/Caches/pypoetry/virtualenvs/realitydb-3Co-d7Gu-py3.10/lib/python3.10/site-packages/pydantic/_internal/_generate_schema.py:312
../../Library/Caches/pypoetry/virtualenvs/realitydb-3Co-d7Gu-py3.10/lib/python3.10/site-packages/pydantic/_internal/_generate_schema.py:312
../../Library/Caches/pypoetry/virtualenvs/realitydb-3Co-d7Gu-py3.10/lib/python3.10/site-packages/pydantic/_internal/_generate_schema.py:312
  /Users/oscarbahamonde/Library/Caches/pypoetry/virtualenvs/realitydb-3Co-d7Gu-py3.10/lib/python3.10/site-packages/pydantic/_internal/_generate_schema.py:312: PydanticDeprecatedSince20: `json_encoders` is deprecated. See https://docs.pydantic.dev/2.9/concepts/serialization/#custom-serializers for alternatives. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.9/migration/
    warnings.warn(

tests/test_item.py:7
  /Users/oscarbahamonde/Desktop/realitydb/tests/test_item.py:7: PytestCollectionWarning: cannot collect test class 'TestDocument' because it has a __init__ constructor (from: tests/test_item.py)
    class TestDocument(DocumentObject):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html

--------- coverage: platform darwin, python 3.10.15-final-0 ----------
Name                      Stmts   Miss  Cover   Missing
-------------------------------------------------------
realitydb/__init__.py         4      0   100%
realitydb/_proxy.py          71     71     0%   1-97
realitydb/documents.py       61     61     0%   1-80
realitydb/models.py         119     68    43%   34, 49, 54-58, 63-68, 73-77, 81-83, 88-93, 97-105, 117-136, 140, 144, 151-161
realitydb/rpc_client.py      78     29    63%   42-43, 47-61, 67, 70, 73, 76, 79, 82-83, 86-90, 93-94, 97-99
realitydb/rpc_server.py      67     23    66%   38, 42, 67-68, 92, 95-121, 133
realitydb/utils.py          109     62    43%   32-39, 43-51, 55, 59, 107-120, 133-140, 155-172, 186-187, 203-204, 219-227, 237-240
-------------------------------------------------------
TOTAL                       509    314    38%

=========================== short test summary info ============================
FAILED tests/test_item.py::test_create_table - AttributeError: 'async_generat...
FAILED tests/test_item.py::test_delete_table - AttributeError: 'async_generat...
FAILED tests/test_item.py::test_get_item - AttributeError: 'async_generator' ...
FAILED tests/test_item.py::test_get_item_not_found - AttributeError: 'async_g...
FAILED tests/test_item.py::test_put_item - AttributeError: 'async_generator' ...
FAILED tests/test_item.py::test_delete_item - AttributeError: 'async_generato...
FAILED tests/test_item.py::test_query - AttributeError: 'async_generator' obj...
FAILED tests/test_item.py::test_update_item - AttributeError: 'async_generato...
FAILED tests/test_item.py::test_connection_handling - AttributeError: 'corout...
======================== 9 failed, 6 warnings in 0.64s =========================
